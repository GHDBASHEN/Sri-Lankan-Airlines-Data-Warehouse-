<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Warehouse Schema Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --db-bg: #f0f4f8;
            --dim-header: #4a5568; /* slate-700 */
            --dim-body: #ffffff;
            --fact-header: #9b2c2c; /* red-800 */
            --fact-body: #fff5f5; /* red-50 */
            --key-pk: #2c5282; /* blue-800 */
            --key-fk: #9b2c2c; /* red-800 */
            --line-color: #718096; /* slate-500 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--db-bg);
            color: #2d3748; /* slate-800 */
        }
        .table-card {
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0; /* slate-200 */
            min-width: 220px;
        }
        .table-header {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .dim-table .table-header { background-color: var(--dim-header); }
        .fact-table .table-header { background-color: var(--fact-header); }
        .table-body {
            padding: 0.5rem;
            font-size: 0.875rem;
        }
        .dim-table .table-body { background-color: var(--dim-body); }
        .fact-table .table-body { background-color: var(--fact-body); }
        .col-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .col-item {
            padding: 0.25rem 0.5rem;
            border-bottom: 1px solid #f7fafc; /* slate-50 */
            position: relative;
        }
        .col-item:last-child {
            border-bottom: none;
        }
        .key-pk, .key-fk {
            font-weight: 600;
        }
        .key-pk { color: var(--key-pk); }
        .key-fk { color: var(--key-fk); }
        .key-tag {
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
            color: white;
        }
        .tag-pk { background-color: var(--key-pk); }
        .tag-fk { background-color: var(--key-fk); }

        #svg-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: visible;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Data Warehouse Schema</h1>
        <p class="text-center text-gray-600 mb-12">An interactive visualization of the tables and their relationships.</p>
    </div>

    <div id="schema-container" class="relative grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-x-8 gap-y-16 items-start">
        <svg id="svg-container"></svg>

        <!-- Dimension Tables -->
        <div class="table-card dim-table lg:col-start-1 justify-self-center" id="dim_date">
            <div class="table-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2zM8.5 7h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm3 0h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zM3 10.5v-1a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3.5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5z"/></svg>
                dim_date
            </div>
            <div class="table-body">
                <ul class="col-list">
                    <li class="col-item key-pk" id="col-dim_date-date_key">date_key<span class="key-tag tag-pk">PK</span></li>
                    <li class="col-item">full_date</li>
                    <li class="col-item">year</li>
                    <li class="col-item">...</li>
                </ul>
            </div>
        </div>

        <div class="table-card dim-table lg:col-start-2 justify-self-center" id="dim_airport">
             <div class="table-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>
                dim_airport
            </div>
            <div class="table-body">
                <ul class="col-list">
                    <li class="col-item key-pk" id="col-dim_airport-airport_key">airport_key<span class="key-tag tag-pk">PK</span></li>
                    <li class="col-item">iata</li>
                    <li class="col-item">name</li>
                    <li class="col-item">city</li>
                     <li class="col-item">...</li>
                </ul>
            </div>
        </div>
        
        <div class="table-card dim-table lg:col-start-4 justify-self-center" id="dim_aircraft">
             <div class="table-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M6.428 1.151C6.708.591 7.213 0 7.86 0h.29a.5.5 0 0 1 .5.5v2.667l4.921 2.953c.24.144.372.404.354.678l-.208 1.666c-.017.135-.043.267-.079.394l.848 1.933c.133.303.095.66-.1.933l-.23.513c-.073.163-.175.313-.303.444l-1.334 1.524c-.11.126-.26.208-.42.234l-1.031.172c-.161.026-.324.026-.485 0l-1.03-.172c-.16-.027-.31-.108-.42-.234L5.344 12.1c-.128-.13-.23-.28-.303-.443l-.23-.513c-.195-.273-.233-.63-.1-.933l.848-1.933a5.034 5.034 0 0 1-.08-.394l-.208-1.666c-.018-.274.114-.534.354-.678L7.29 4.318V.5a.5.5 0 0 1 .5-.5h-.29c-.646 0-1.151.59-1.43 1.151L.21 8.49c-.253.58-.087 1.29.384 1.667l1.013.81c.21.168.48.253.753.253h10.27c.272 0 .542-.085.753-.253l1.013-.81c.47-.376.636-1.087.384-1.667L8.842 1.151z"/></svg>
                dim_aircraft
            </div>
            <div class="table-body">
                <ul class="col-list">
                    <li class="col-item key-pk" id="col-dim_aircraft-aircraft_key">aircraft_key<span class="key-tag tag-pk">PK</span></li>
                    <li class="col-item">tail_number</li>
                    <li class="col-item">model</li>
                    <li class="col-item">effective_from</li>
                    <li class="col-item">...</li>
                </ul>
            </div>
        </div>

        <div class="table-card dim-table lg:col-start-5 justify-self-center" id="dim_passenger">
             <div class="table-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/></svg>
                dim_passenger
            </div>
            <div class="table-body">
                <ul class="col-list">
                    <li class="col-item key-pk" id="col-dim_passenger-passenger_key">passenger_key<span class="key-tag tag-pk">PK</span></li>
                    <li class="col-item">passenger_id_external</li>
                    <li class="col-item">first_name</li>
                    <li class="col-item">...</li>
                </ul>
            </div>
        </div>
        
        <div class="table-card dim-table md:col-span-3 lg:col-start-3 lg:col-span-1 justify-self-center self-start" id="dim_flight">
            <div class="table-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 2.1a.5.5 0 0 1 .5.5v1.181A1.5 1.5 0 0 1 2.5 5h11a1.5 1.5 0 0 1 1.5 1.5v1.181a.5.5 0 0 1-1 0V6.5A.5.5 0 0 0 13.5 6h-11a.5.5 0 0 0-.5.5v1.181a.5.5 0 0 1-1 0V2.6a.5.5 0 0 1 .5-.5zm15 7.482a.5.5 0 0 1 .5.5v1.181a1.5 1.5 0 0 1-1.5 1.5h-11a1.5 1.5 0 0 1-1.5-1.5v-1.18a.5.5 0 0 1 1 0v1.181a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5v-1.181a.5.5 0 0 1 .5-.5z"/></svg>
                dim_flight
            </div>
            <div class="table-body">
                <ul class="col-list">
                    <li class="col-item key-pk" id="col-dim_flight-flight_key">flight_key<span class="key-tag tag-pk">PK</span></li>
                    <li class="col-item">carrier_code</li>
                    <li class="col-item">flight_number</li>
                    <li class="col-item">...</li>
                </ul>
            </div>
        </div>

        <!-- Fact Tables -->
        <div class="table-card fact-table md:col-start-1 md:col-span-3 lg:col-span-3 lg:col-start-2 justify-self-stretch self-center" id="fact_flights">
            <div class="table-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zM2.5 3a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11zm0 10a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11z"/></svg>
                fact_flights
            </div>
            <div class="table-body">
                <ul class="col-list">
                    <li class="col-item key-pk" id="col-fact_flights-flight_occurrence_key">flight_occurrence_key<span class="key-tag tag-pk">PK</span></li>
                    <li class="col-item key-fk" id="col-fact_flights-flight_key">flight_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item key-fk" id="col-fact_flights-aircraft_key">aircraft_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item key-fk" id="col-fact_flights-date_key">date_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item key-fk" id="col-fact_flights-origin_airport_key">origin_airport_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item key-fk" id="col-fact_flights-dest_airport_key">dest_airport_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item">seats_occupied</li>
                    <li class="col-item">delay_arrival_minutes</li>
                    <li class="col-item">...</li>
                </ul>
            </div>
        </div>

        <div class="table-card fact-table md:col-span-3 lg:col-span-3 lg:col-start-2 justify-self-stretch self-end" id="fact_ticket_sales">
            <div class="table-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zM2.5 3a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11zm0 10a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11z"/></svg>
                fact_ticket_sales
            </div>
             <div class="table-body">
                <ul class="col-list">
                    <li class="col-item key-pk" id="col-fact_ticket_sales-ticket_key">ticket_key<span class="key-tag tag-pk">PK</span></li>
                    <li class="col-item key-fk" id="col-fact_ticket_sales-flight_occurrence_key">flight_occurrence_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item key-fk" id="col-fact_ticket_sales-passenger_key">passenger_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item key-fk" id="col-fact_ticket_sales-booking_date_key">booking_date_key<span class="key-tag tag-fk">FK</span></li>
                    <li class="col-item">net_amount</li>
                    <li class="col-item">...</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const connections = [
                // fact_flights connections
                { from: 'col-fact_flights-flight_key', to: 'col-dim_flight-flight_key', fromSide: 'top', toSide: 'bottom'},
                { from: 'col-fact_flights-aircraft_key', to: 'col-dim_aircraft-aircraft_key', fromSide: 'right', toSide: 'left' },
                { from: 'col-fact_flights-date_key', to: 'col-dim_date-date_key', fromSide: 'left', toSide: 'right' },
                { from: 'col-fact_flights-origin_airport_key', to: 'col-dim_airport-airport_key', fromSide: 'left', toSide: 'right' },
                { from: 'col-fact_flights-dest_airport_key', to: 'col-dim_airport-airport_key', fromSide: 'left', toSide: 'right', anchor: 'end' },

                // fact_ticket_sales connections
                { from: 'col-fact_ticket_sales-flight_occurrence_key', to: 'col-fact_flights-flight_occurrence_key', fromSide: 'top', toSide: 'bottom' },
                { from: 'col-fact_ticket_sales-passenger_key', to: 'col-dim_passenger-passenger_key', fromSide: 'right', toSide: 'left' },
                { from: 'col-fact_ticket_sales-booking_date_key', to: 'col-dim_date-date_key', fromSide: 'left', toSide: 'right', anchor: 'start' }
            ];

            const svg = document.getElementById('svg-container');
            const container = document.getElementById('schema-container');

            function drawLines() {
                svg.innerHTML = ''; // Clear existing lines
                const containerRect = container.getBoundingClientRect();

                connections.forEach(conn => {
                    const fromEl = document.getElementById(conn.from);
                    const toEl = document.getElementById(conn.to);

                    if (!fromEl || !toEl) {
                        console.warn(`Could not find elements for connection:`, conn);
                        return;
                    }

                    const fromRect = fromEl.getBoundingClientRect();
                    const toRect = toEl.getBoundingClientRect();
                    
                    const fromPoint = getAttachPoint(fromRect, containerRect, conn.fromSide, conn.anchor);
                    const toPoint = getAttachPoint(toRect, containerRect, conn.toSide, conn.anchor);

                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    
                    const midX = (fromPoint.x + toPoint.x) / 2;
                    const midY = (fromPoint.y + toPoint.y) / 2;

                    let d;
                    if (conn.fromSide === 'top' || conn.fromSide === 'bottom') {
                        d = `M ${fromPoint.x} ${fromPoint.y} C ${fromPoint.x} ${midY}, ${toPoint.x} ${midY}, ${toPoint.x} ${toPoint.y}`;
                    } else {
                         d = `M ${fromPoint.x} ${fromPoint.y} C ${midX} ${fromPoint.y}, ${midX} ${toPoint.y}, ${toPoint.x} ${toPoint.y}`;
                    }
                    
                    path.setAttribute('d', d);
                    path.setAttribute('stroke', 'var(--line-color)');
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('marker-end', 'url(#arrowhead)');
                    
                    svg.appendChild(path);
                });
            }
            
            function getAttachPoint(rect, containerRect, side, anchor = 'middle') {
                const x = rect.left - containerRect.left;
                const y = rect.top - containerRect.top;
                let yOffset;

                switch(anchor) {
                    case 'start': yOffset = rect.height * 0.25; break;
                    case 'end': yOffset = rect.height * 0.75; break;
                    default: yOffset = rect.height / 2;
                }
                
                switch(side) {
                    case 'top': return { x: x + rect.width / 2, y: y };
                    case 'bottom': return { x: x + rect.width / 2, y: y + rect.height };
                    case 'left': return { x: x, y: y + yOffset };
                    case 'right': return { x: x + rect.width, y: y + yOffset };
                    default: return { x: x + rect.width / 2, y: y + rect.height / 2 };
                }
            }

            // Define arrowhead marker
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            marker.setAttribute('id', 'arrowhead');
            marker.setAttribute('viewBox', '0 0 10 10');
            marker.setAttribute('refX', '8');
            marker.setAttribute('refY', '5');
            marker.setAttribute('markerWidth', '6');
            marker.setAttribute('markerHeight', '6');
            marker.setAttribute('orient', 'auto-start-reverse');
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            polygon.setAttribute('points', '0 0, 10 5, 0 10');
            polygon.setAttribute('fill', 'var(--line-color)');
            marker.appendChild(polygon);
            defs.appendChild(marker);
            svg.appendChild(defs);

            // Initial draw and redraw on resize
            setTimeout(drawLines, 50); // Small delay to ensure layout is stable
            window.addEventListener('resize', drawLines);
        });
    </script>
</body>
</html>
